/*
 * File name          : Server.js
 * Author             : Hayato Doi
 * Last Update        : 2016/10/31
 * Since              : 2016/10/28
 * Outline            : ------
 * Update information : --
 * Copyright (c) 2016, Hayato Doi
 */
var Config = require('./Config.json');
var Server = require('http').createServer();
var fs = require('fs');
// *Server startup
Server.on('request', function(req, res){
	req.url = decodeURI(req.url);
	console.log(__dirname + '/www' + req.url);
	// *!! Directory traversal !!
	if( req.url.match(/\.node$/) ){
		try{
			var resdata = require(__dirname + '/www' + req.url.replace(/\.node$/g,'.js')).data(req);
			res.writeHead(200, {'Content-Type': 'text/html'});
			console.log(resdata);
			res.write(resdata);
			res.end();
		}
		catch(e){
			res.writeHead(500, {'Content-Type': 'text/html'});
			res.write('Internal Server Error');
			console.log(e);
			res.end();
		}
	}
	else{
		fs.readFile( __dirname + '/Views' + req.url , 'utf-8', function(err, data){
			if(err){
				res.writeHead(404, {'Content-Type': 'text/plain'});
				res.write('Not Found');
				console.log(err);
				return res.end();ã€€
			}
			res.writeHead(200, {'Content-Type': 'text/html'});
			res.write(data);
			res.end();
		});
	}
});
/* __main__ */
Server.listen(Config.Port,Config.Address);
